<!DOCTYPE html>
<link rel=icon href=/favicon.png>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
  <title>Smart Quora</title>
  <script src='lib/jquery-1.8.0.min.js' type='text/javascript'></script>
  <script src='lib/jquery.slideto.min.js' type='text/javascript'></script>
  <script src='lib/jquery.wiggle.min.js' type='text/javascript'></script>
  <script src='lib/jquery.ba-bbq.min.js' type='text/javascript'></script>
  <script src="js/Alerts.js"></script>
  <script src="js/CommonUtils.js"></script>
  <script src="js/QuoraUtils.js"></script>
  <script type="text/javascript">
    const host = "https://ec2-35-168-150-155.compute-1.amazonaws.com:3000"
    const qurl = host + "/api/smartquora.question.Question/";
    const faqurl = host + "/api/queries/FindAllQuestions";
    const pingurl = host + "/api/system/ping";
    const loginurl = host + "/auth/google";

    function paintPage() {
      var access_token = getCookie('access_token');
      if (!access_token) {
        console.log("No access_token cookie found - Redirecting to authenticate.");
        authenticationRedirect(access_token, pingurl, loginurl);
        return;
      }
      var matches = access_token.match(/^s:(.+?)\./);
      if (!matches) {
        console.log("access_token cookie was found, but it was broken! Redirecting to authenticate.");
        authenticationRedirect(access_token, pingurl, loginurl);
        return;
      }
      access_token = matches[1];
      console.log("Access Token :" + access_token);
      paintQuestions(access_token);
    }

    function paintQuestions(accessToken) {
      getData(faqurl, "", accessToken)
        .then(function(data) {
          console.log("Questions: " + JSON.stringify(data, null, 2));
          for (var i = 0; i < data.length; i++) {
            question = data[i];
            addQuestionToTable(question["questionId"], question["questionDesc"], question["status"], question["stake"], question["balance"],question["timeCreated"], question["timeToAward"]);
          }
        })
        .catch(function(reason) {
          console.log(reason.message)
        });
    }


    function addQuestionToTable(questionId, questionDesc, status, stake, balance, timeCreated, timeToAward) {
      console.log("timeToAward: " + timeToAward);
      var due = new Date(timeToAward);
      var dueTS = due.toLocaleDateString() + " " + due.toLocaleTimeString();
      var tableBody = "q-table-body";
      var quotedQid = "\"/question.html?qid=" + questionId + "\"";
      var href = "<a  href=" + quotedQid + "><div class='font-weight-normal' align='left'>"+ questionId +"</div></a>";
      var tableRef = document.getElementById(tableBody);
      var row = tableRef.insertRow(tableRef.rows.length);
      var cell0 = row.insertCell(0);
      cell0.innerHTML = href;
      var cell1 = row.insertCell(1);
      cell1.innerHTML = "<div class='font-weight-normal' align='left'>" + questionDesc + "</div>";;
      var cell2 = row.insertCell(2);
      cell2.innerHTML = "<div class='font-weight-normal' align='left'>" + status + "</div>";
      var cell3 = row.insertCell(3);
      cell3.innerHTML = "<div class='font-weight-normal' align='left'>" + stake + "</div>";
      var cell4 = row.insertCell(4);
      cell4.innerHTML = "<div class='font-weight-normal' align='left'>" + dueTS + "</div>";;
      console.log('Exiting addRow');
    }
  </script>
</head>


<a href="#"></a>
<body>
  <h1 class="display-3 text-center my-4 bg-dark text-light p-3">Smart Quora</h1>
  <div class="container">
    <h2 class="display-5 text-center my-4">Questions</h2>
    <div id="questions">
      <table id="q-table" class="table table-sm table-hover table-striped">
        <thead>
          <tr>
            <th>Id</th>
            <th>Question</th>
            <th>Status</th>
            <th>Stake</th>
            <th>Due</th>
          </tr>
        </thead>
        <tbody id="q-table-body">
        </tbody>
      </table>
    </div>
  </div>
  <hr>



  <div style="margin-top:500px;"></div>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script type="text/javascript">
    window.onload = paintPage();
  </script>
</body>

</html>
